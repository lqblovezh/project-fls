/*!
 * {
 *   "buildtime": "2019-05-31 16:22:54",
 *   "workspace": "F:\\X-BOOK\\xcloud\\x-book4\\js",
 *   "username": "LQB",
 *   "hostname": "DESKTOP-QL56OJS",
 *   "platform": "win32",
 *   "git": {
 *     "branch": "master",
 *     "hash": "fbc007935",
 *     "message": [
 *       "commit fbc00793544e5767db1868f95f89c64b93f3aa79",
 *       "Author: 骆秋波 <1277678760@qq.com>",
 *       "Date:   Fri May 31 15:21:03 2019 +0800",
 *       "    打包上传"
 *     ],
 *     "user": "骆秋波",
 *     "email": "1277678760@qq.com",
 *     "remote": [
 *       "origin http://gitlab.kf.gli.cn/xcloud/x-book4.git (fetch)",
 *       "origin http://gitlab.kf.gli.cn/xcloud/x-book4.git (push)"
 *     ]
 *   }
 * }
 */
(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{203:function(t,e,r){"use strict";r.r(e);var n=r(366),i=r(287);for(var a in i)"default"!==a&&function(t){r.d(e,t,function(){return i[t]})}(a);r(355);var s=r(2),o=Object(s.a)(i.default,n.a,n.b,!1,null,"baeb2b0e",null);e.default=o.exports},287:function(t,e,r){"use strict";r.r(e);var n=r(288),i=r.n(n);for(var a in n)"default"!==a&&function(t){r.d(e,t,function(){return n[t]})}(a);e.default=i.a},288:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=c(r(18)),i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},a=c(r(211)),s=c(r(308)),o=c(r(309)),l=c(r(310)),u=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(354));r(93);function c(t){return t&&t.__esModule?t:{default:t}}function p(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,r){return function n(i,a){try{var s=e[i](a),o=s.value}catch(t){return void r(t)}if(!s.done)return Promise.resolve(o).then(function(t){n("next",t)},function(t){n("throw",t)});t(o)}("next")})}}e.default={components:{Demo:s.default,About:o.default,Cooperate:l.default},data:function(){return{tabs:[],tableData:[],currentIndex:"",shop_type:0,ids:[],page:{pageNum:1,pageOffset:10},form:{id:"",name:"",abs:"",img_src:""},dialogVisible:!1,imageCropperDialog:!1,autoCrop:{read:[292,400],magazine:[292,400],teach:[310,188],library:[260,350]},imgFile:null}},created:function(){this.getType()},computed:{ratio:function(){var t=this.form.work_type,e=this.autoCrop[t];return Number((e[0]/e[1]).toFixed(2))},autoCropWidth:function(){var t=this.form.work_type;return this.autoCrop[t][0]},autoCropHeight:function(){var t=this.form.work_type;return this.autoCrop[t][1]}},methods:{getType:function(){var t=this;u.getType().then(function(e){t.tabs=e.data,t.tabs,t.getList()})},handleClose:function(){this.dialogVisible=!1},shelf:function(t){var e=this;u.shelf({id:t,index_type:1}).then(function(t){e.getList()})},modify:function(t){var e=this;return p(n.default.mark(function t(){return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:u.shelf(i({id:e.form.publisher_id},e.form)).then(function(t){e.dialogVisible=!1,e.getList()});case 1:case"end":return t.stop()}},t,e)}))()},open:function(t){this.form=i({},t),this.form,this.dialogVisible=!0},upload:function(t,e){var r,i=this,a=t.target.files[0];this.imgFile=URL.createObjectURL(a),this.$ImageSize({file:a,ratio:this.ratio,interval:.05}).then((r=p(n.default.mark(function t(e){var r,s,o;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.$globalUpdateFile(a);case 2:r=t.sent,s=r.url,o=r.path,i.$set(i.form,"img",o),i.$set(i.form,"img_src",s);case 7:case"end":return t.stop()}},t,i)})),function(t){return r.apply(this,arguments)}),function(t){201!=t.status?i.$message.error(t.message):i.imageCropperDialog=!0})},getList:function(t){var e=this,r=JSON.parse(JSON.stringify(this.page));u.getList(i({type:this.currentIndex,shop_type:this.shop_type},r,t)).then(function(t){e.tableData=t.data,e.page.total=t.page.total,e.page.pageNum=t.page.num})},change:function(t){this.currentIndex=t},seareHandeler:function(){this.query=(0,a.default)(document.querySelector("#mainForm"),{hash:!0}),this.getList(this.query)},handleSelectionChange:function(t){this.ids=t.map(function(t){return t.id})},delChoosen:function(t){var e=this;return p(n.default.mark(function r(){return n.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e.$confirm("是否删除?").then(function(r){(u.del?u.del:e.del)({id:t}).then(function(t){e.getList()})}).catch(function(t){});case 1:case"end":return r.stop()}},r,e)}))()},currentChange:function(t){this.page.pageNum=t,this.getList()},detail:function(t){this.currentItem=t},sort:function(t,e){var r=this;u.sort({type:this.currentIndex,shop_type:this.shop_type,id:t,status:e}).then(function(){r.getList(),r.$message.success("移动成功")}).catch(function(t){r.$message.error("移动失败")})},preview:function(t){var e=this;return p(n.default.mark(function r(){var i,a,s;return n.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e.imgFiles=t,e.imgFiles.name="img",r.next=4,e.$globalUpdateFile(e.imgFiles);case 4:i=r.sent,a=i.url,s=i.path,e.$set(e.form,"img",s),e.$set(e.form,"img_src",a),e.imageCropperDialog=!1;case 10:case"end":return r.stop()}},r,e)}))()}},watch:{currentIndex:function(){this.getList()},shop_type:function(){this.getList()}}}},289:function(t,e,r){},354:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getType=function(t){return(0,i.request_get)("/system/api/works_type",t)},e.getList=function(t){return(0,i.request_get)("/system/api/works",t)},e.shelf=function(t){return(0,i.request_put)(s(t),t)},e.del=function(t){return(0,i.request_post)("/system/api/works/delete",t)},e.sort=function(t){return(0,i.request_put)("/system/api/works/sort/"+t.id,t)};var n,i=r(65),a=r(66);var s=((n=a)&&n.__esModule?n:{default:n}).default.compile("/system/api/works/:id")},355:function(t,e,r){"use strict";var n=r(289);r.n(n).a},366:function(t,e,r){"use strict";var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"content"},[t.imageCropperDialog?r("ImageCropper",{ref:"imageCropper",attrs:{imageCropperDialog:t.imageCropperDialog,imgFile:t.imgFile,autoCropWidth:t.autoCropWidth,autoCropHeight:t.autoCropHeight},on:{"update:imageCropperDialog":function(e){t.imageCropperDialog=e},"update:image-cropper-dialog":function(e){t.imageCropperDialog=e},preview:t.preview}}):t._e(),r("el-dialog",{attrs:{visible:t.dialogVisible,width:"800px","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("div",{staticClass:"detailBox"},[r("div",{staticClass:"part"},[r("div",{staticClass:"img"},[r("img",{ref:"img1",attrs:{src:t.form.img_src}})]),r("input",{ref:"updateImg1",staticClass:"hide",attrs:{type:"file",accept:"image/*"},on:{change:function(e){return t.upload(e,"img1")}}}),r("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.$refs.updateImg1.click()}}},[t._v("选择图片")])],1),r("el-input",{staticClass:"name",attrs:{placeholder:"名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}}),r("el-input",{staticClass:"url",attrs:{placeholder:"简介"},model:{value:t.form.abs,callback:function(e){t.$set(t.form,"abs",e)},expression:"form.abs"}})],1),r("div",{staticClass:"footer dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{staticClass:"right",attrs:{type:"primary",size:"small"},on:{click:function(e){return t.modify(["updateImg1"])}}},[t._v("确定")])],1)]),r("div",{staticClass:"tabs"},[r("el-radio-group",{model:{value:t.shop_type,callback:function(e){t.shop_type=e},expression:"shop_type"}},[r("el-radio",{attrs:{label:0}},[t._v("全部")]),r("el-radio",{attrs:{label:1}},[t._v("整库")]),r("el-radio",{attrs:{label:2}},[t._v("详情")])],1),r("el-select",{attrs:{placeholder:"分类选择",clearable:""},model:{value:t.currentIndex,callback:function(e){t.currentIndex=e},expression:"currentIndex"}},t._l(t.tabs,function(t){return r("el-option",{key:t.type,attrs:{label:t.name,value:t.type}})}),1)],1),r("div",{staticClass:"box"},[r("form",{attrs:{id:"mainForm"}},[t._m(0),t._m(1),r("span",{staticClass:"group-inline"},[r("el-button",{staticClass:"right",attrs:{type:"primary",size:"small",icon:"el-icon-search",plain:""},on:{click:t.seareHandeler}},[t._v("搜索")])],1)]),r("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{stripe:"",data:t.tableData,"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55",fixed:""}}),r("el-table-column",{attrs:{prop:"name",label:"名称"}}),r("el-table-column",{attrs:{prop:"work_name",label:"出版社"}}),r("el-table-column",{attrs:{prop:"user_name",label:"用户账户"}}),r("el-table-column",{attrs:{prop:"file_code",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s("yes"==n.index_type?"已上架":"未上架"))])]}}])}),r("el-table-column",{attrs:{label:"操作",width:"400"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return["yes"==n.type&&"yes"!=n.index_type?r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.open(n)}}},[t._v("修改")]):t._e(),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.sort(n.publisher_id,"up")}}},[t._v("上移")]),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.sort(n.publisher_id,"down")}}},[t._v("下移")]),"yes"==n.type&&"yes"!=n.index_type?r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.shelf(n.publisher_id)}}},[t._v("上架")]):t._e(),"yes"==n.type&&"yes"==n.index_type?r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.shelf(n.publisher_id)}}},[t._v("下架")]):t._e(),r("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.delChoosen([n.publisher_id])}}},[t._v("删除")])]}}])})],1),t.page.total?r("div",{staticClass:"pages"},[r("Pages",{attrs:{currentPage:t.page.num,total:t.page.total,pageSize:t.page.pageOffset,pageSizes:[10,20,50,100]},on:{currentChange:t.currentChange}})],1):t._e()],1)],1)},i=[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"group-inline"},[e("input",{staticClass:"form-control",attrs:{name:"name",placeholder:"名称"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"group-inline"},[e("input",{staticClass:"form-control",attrs:{name:"press_name",placeholder:"出版社"}})])}];r.d(e,"a",function(){return n}),r.d(e,"b",function(){return i})}}]);