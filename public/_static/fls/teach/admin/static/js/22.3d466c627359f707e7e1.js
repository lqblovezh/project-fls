/*!
 * {
 *   "buildtime": "2019-06-14 15:40:00",
 *   "workspace": "F:\\project\\x-book4\\js",
 *   "username": "Administrator",
 *   "hostname": "PC201608171616",
 *   "platform": "win32",
 *   "git": {
 *     "branch": "master",
 *     "hash": "cc62e1956",
 *     "message": [
 *       "commit cc62e195633d44aadf65545d70d92ce1a5c1c701",
 *       "Author: YangZai <552396385@qq.com>",
 *       "Date:   Fri Jun 14 15:39:28 2019 +0800",
 *       "    'xxx'"
 *     ],
 *     "user": "YangZai",
 *     "email": "552396385@qq.com",
 *     "remote": [
 *       "origin http://gitlab.kf.gli.cn/xcloud/x-book4.git (fetch)",
 *       "origin http://gitlab.kf.gli.cn/xcloud/x-book4.git (push)"
 *     ]
 *   }
 * }
 */
(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1437:function(e,t,i){"use strict";var s=i(652);i.n(s).a},1518:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("TPL",{ref:"child",attrs:{total:e.total},on:{sizeChange:e.handleSizeChange,currentChange:e.handleCurrentChange}},[i("div",{staticClass:"search",attrs:{slot:"search"},slot:"search"},[i("el-input",{staticClass:"dy_inputWidth",attrs:{placeholder:"用户",clearable:""},model:{value:e.query.user_name,callback:function(t){e.$set(e.query,"user_name",t)},expression:"query.user_name"}}),i("TimePick",{attrs:{placeholder:["创建时间","结束时间"]},on:{getTime:e.getTime}}),i("el-button",{staticClass:"el-icon-search",attrs:{type:"primary"},on:{click:function(t){return e.seareHandeler(e.query)}}},[e._v("搜索")])],1),i("div",{staticClass:"list",attrs:{slot:"list"},slot:"list"},[e._l(e.tableData,function(t){return i("div",{staticClass:"item"},[i("div",{staticClass:"title"},[i("b",[e._v(e._s(t.from_user_name))]),i("b",[e._v(e._s(t.create_time))])]),i("div",{staticClass:"msg"},[e._v(e._s(t.content))]),i("div",{staticClass:"handle"},[i("span",{on:{click:function(i){return e.detail(t,!0)}}},[e._v("查看对话")]),i("span",{on:{click:function(i){return e.detail(t,!1)}}},[e._v("回复")]),i("span",{staticClass:"danger",on:{click:function(i){return e.del(t.id)}}},[e._v("删除")])])])}),i("el-dialog",{staticClass:"dialog",attrs:{visible:e.dialogVisible,width:"1000px","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[e.active?e._e():i("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[e._v("回复内容：")]),i("div",{staticClass:"all"},[e.active?i("div",{staticClass:"msgInfo"},[i("div",{staticClass:"item"},[i("div",{staticClass:"title"},[i("b",{staticClass:"dy_primary"},[e._v("信件内容")]),i("b",{staticClass:"dy_primary"},[e._v("收于："+e._s(e.msgInfo.create_time))])]),i("div",{staticClass:"msg"},[e._v(e._s(e.msgInfo.content))]),e._l(e.messageList,function(t){return i("div",{staticClass:"reply"},[i("div",{staticClass:"title"},[i("b",{staticClass:"dy_primary"},[e._v(e._s(t.from_user_name)+" 回复：")]),i("b",{staticClass:"dy_primary"},[e._v(e._s(t.create_time))])]),i("div",{staticClass:"msg"},[e._v(e._s(t.content))])])})],2)]):i("div",{staticClass:"msgBack"},[i("el-input",{attrs:{type:"textarea",rows:7,placeholder:"请输入回复内容"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1)]),e.active?i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.tabs}},[e._v("回复")])],1):i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:e.tabs}},[e._v("返回")]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.send}},[e._v("发送")])],1)]),e.tableData.length?e._e():i("div",{staticClass:"noMsg"},[e._v("暂无数据")])],2)])},a=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return a})},245:function(e,t,i){"use strict";i.r(t);var s=i(1518),a=i(650);for(var n in a)"default"!==n&&function(e){i.d(t,e,function(){return a[e]})}(n);i(1437);var r=i(0),o=Object(r.a)(a.default,s.a,s.b,!1,null,"c7a8fa76",null);t.default=o.exports},277:function(e,t){var i=/^(?:submit|button|image|reset|file)$/i,s=/^(?:input|select|textarea|keygen)/i,a=/(\[[^\[\]]*\])/g;function n(e,t,i){if(t.match(a)){!function e(t,i,s){if(0===i.length)return t=s;var a=i.shift(),n=a.match(/^\[(.+?)\]$/);if("[]"===a)return t=t||[],Array.isArray(t)?t.push(e(null,i,s)):(t._values=t._values||[],t._values.push(e(null,i,s))),t;if(n){var r=n[1],o=+r;isNaN(o)?(t=t||{})[r]=e(t[r],i,s):(t=t||[])[o]=e(t[o],i,s)}else t[a]=e(t[a],i,s);return t}(e,function(e){var t=[],i=new RegExp(a),s=/^([^\[\]]*)/.exec(e);for(s[1]&&t.push(s[1]);null!==(s=i.exec(e));)t.push(s[1]);return t}(t),i)}else{var s=e[t];s?(Array.isArray(s)||(e[t]=[s]),e[t].push(i)):e[t]=i}return e}function r(e,t,i){return i=i.replace(/(\r)?\n/g,"\r\n"),i=(i=encodeURIComponent(i)).replace(/%20/g,"+"),e+(e?"&":"")+encodeURIComponent(t)+"="+i}e.exports=function(e,t){"object"!=typeof t?t={hash:!!t}:void 0===t.hash&&(t.hash=!0);for(var a=t.hash?{}:"",o=t.serializer||(t.hash?n:r),u=e&&e.elements?e.elements:[],l=Object.create(null),c=0;c<u.length;++c){var d=u[c];if((t.disabled||!d.disabled)&&d.name&&s.test(d.nodeName)&&!i.test(d.type)){var f=d.name,h=d.value;if("checkbox"!==d.type&&"radio"!==d.type||d.checked||(h=void 0),t.empty){if("checkbox"!==d.type||d.checked||(h=""),"radio"===d.type&&(l[d.name]||d.checked?d.checked&&(l[d.name]=!0):l[d.name]=!1),void 0==h&&"radio"==d.type)continue}else if(!h)continue;if("select-multiple"!==d.type)a=o(a,f,h);else{h=[];for(var m=d.options,v=!1,p=0;p<m.length;++p){var g=m[p],_=t.empty&&!g.value,y=g.value||_;g.selected&&y&&(v=!0,a=t.hash&&"[]"!==f.slice(f.length-2)?o(a,f+"[]",g.value):o(a,f,g.value))}!v&&t.empty&&(a=o(a,f,""))}}}if(t.empty)for(var f in l)l[f]||(a=o(a,f,""));return a}},278:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.main=void 0;var s,a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},n=i(277);(s=n)&&s.__esModule;var r={data:function(){return{tableData:[],total:0,page:{pageOffset:10,pageNum:1},ids:[],isTeacher:"",dialogVisible:!1,detailVisible:!1,detailData:[],productType:null}},created:function(){this.isTeacher=this.$config.isTeacher,this.getList(a({},this.query,this.page))},methods:{seareHandeler:function(){this.page.pageNum=1,this.getList(a({},this.query))},getList:function(e){var t=this;this.service&&this.service.getList(a({},this.page,this.query,e)).then(function(e){e&&e.status&&(t.tableData=e.data,t.total=e.page.total)})},handleSelectionChange:function(e){this.ids=e.map(function(e){return e.id}),this.multipleSelection=e},update:function(e,t){this.$refs[t].src=URL.createObjectURL(e.target.files[0])},getTime:function(e){e||(e=["",""]),this.query.time_start=e[0],this.query.time_end=e[1],this.query.start_time=e[0],this.query.end_time=e[1]},handleSizeChange:function(e){this.page.pageOffset=e,this.getList(a({},this.page,this.query))},handleCurrentChange:function(e){this.page.pageNum=e,this.getList(a({},this.page,this.query))},handleClose:function(){this.detailVisible=!1,this.dialogVisible=!1},del:function(e){var t=this;if(!e){if(!this.ids.length)return this.$message.warning("请先选中");e=this.ids}this.$confirm("你真的要删除该数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.service.del({id:e}).then(function(e){e&&e.status&&(t.getList(a({},t.page,t.query)),t.$message.success("删除成功"))},function(e){var i=e.payload;t.$message.error(i.message)})}).catch(function(){})},save:function(e){var t=this;e||(e=this.form),this.service.save(e).then(function(e){e.status&&(t.$message.success("保存成功"),t.getList(t.query)),t.dialogVisible=!1,t.$refs.child&&(t.$refs.child.dialogVisible=!1)},function(e){t.$message.error(e.payload.message)})},educe:function(e){this.service.educe({id:e}).then(function(e){window.location.href=e.data.url})},detail:function(e){var t=this;this.service.detail({id:e}).then(function(e){t.detailData=e.data,log(e,"detail")}),this.$refs.child.dialogVisible=!0},showDetail:function(e,t){var i=this;log("------------"),this.service.detail({id:e}).then(function(e){log(e,"detailInfo"),i.detailData=e.data,i.productType=t,i.detailVisible=!0})}}};t.main=r},296:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getList=function(e){return a.request_get("/api/message/user",e)},t.save=function(e){return a.request_post("/api/message",e)},t.del=function(e){return a.request_delete(r(e),e)},t.getMsgInfo=function(e){return a.request_get("/api/message/record",e)};var s,a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(49)),n=i(82);var r=((s=n)&&s.__esModule?s:{default:s}).default.compile("/api/message/:id")},333:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pub=void 0;var s,a=i(20),n=(s=a)&&s.__esModule?s:{default:s};var r={data:function(){return{ids:[],msgInfo:[],active:!0,dialogVisible:!1}},methods:{handleSelectionChange:function(e){this.ids=e.map(function(e){return e.id}),this.multipleSelection=e},tabs:function(){this.active=!this.active},send:function(){var e,t=this;return(e=n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.form.content){e.next=3;break}return t.$message.error("消息内容不能为空"),e.abrupt("return");case 3:return e.next=5,t.service.save(t.form).then(function(e){e&&e.status&&(t.$message.success("发送成功"),t.active=!t.active,t.msgInfo.reply&&(t.msgInfo.reply.push({from_user_name:t.msgInfo.to_user_name,content:t.form.content,create_time:t.getNowFormatDate()}),t.form.content=""))});case 5:case"end":return e.stop()}},e,t)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function s(a,n){try{var r=t[a](n),o=r.value}catch(e){return void i(e)}if(!r.done)return Promise.resolve(o).then(function(e){s("next",e)},function(e){s("throw",e)});e(o)}("next")})})()},getNowFormatDate:function(){var e=new Date,t=e.getMonth()+1,i=e.getDate();return t>=1&&t<=9&&(t="0"+t),i>=0&&i<=9&&(i="0"+i),e.getFullYear()+"-"+t+"-"+i+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},detail:function(e,t){this.form.content=" ",this.msgInfo=e,this.form.from_user_id=e.to_user_id,this.form.to_user_id=e.from_user_id,this.form.pid=e.id,this.active=t,this.dialogVisible=!0},handleClose:function(){this.dialogVisible=!1}}};t.pub=r},650:function(e,t,i){"use strict";i.r(t);var s=i(651),a=i.n(s);for(var n in s)"default"!==n&&function(e){i.d(t,e,function(){return s[e]})}(n);t.default=a.a},651:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},a=i(278),n=i(333),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(296));t.default={mixins:[a.main,n.pub],data:function(){return{query:{user_name:"",type:"private_message",time_start:"",time_end:""},service:r,form:{type:"private_message",from_user_id:"",to_user_id:"",content:"",pid:""},messageList:[]}},created:function(){this.$route.query.id?this.$router.push({path:"/wms/message/show",query:{id:this.$route.query.id}}):this.getList(s({},this.query,this.page))},methods:{detail:function(e,t){var i=this;r.getMsgInfo({to_user_id:e.user_id}).then(function(s){i.form.content=" ",i.msgInfo=e,i.form.from_user_id=e.to_user_id,i.form.to_user_id=e.from_user_id,i.form.pid=e.id,i.active=t,i.dialogVisible=!0,i.messageList=s.data})}}}},652:function(e,t,i){}}]);