(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{162:function(t,e,n){"use strict";n.r(e);var a=n(163),o=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,function(){return a[t]})}(i);e.default=o.a},163:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a,o=n(8),i=(a=o)&&a.__esModule?a:{default:a},r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},s=n(88),u=n(18);e.default={mixins:[s.main],data:function(){return{toPath:"/qus",params:{}}},methods:{getList:function(){var t,e=this;return(t=i.default.mark(function t(){var n;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.$route.query.id,e.params=e.fetch(),e.$dialog.loading.open("加载数据中..."),!n||e.params.qus){t.next=6;break}return t.next=6,(0,u.get_content)({id:n}).then(function(t){e.params=e.fetch(),t.data.n=0,t.data.questions.map(function(t){}),e.$set(e.params,"qus",r({},e.$route.query,{app_id:t.data.id,data:t.data}))},function(t){e.$dialog.loading.close()});case 6:e.toPath="/qus?id="+e.params.qus.id+"&qrcode_product_id="+e.params.qus.qrcode_product_id,e.info=e.params.qus.data,e.$dialog.loading.close();case 9:case"end":return t.stop()}},t,e)}),function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function a(o,i){try{var r=e[o](i),s=r.value}catch(t){return void n(t)}if(!r.done)return Promise.resolve(s).then(function(t){a("next",t)},function(t){a("throw",t)});t(s)}("next")})})()},next:function(){this.info.n++,this.n>=this.info.questions.length&&(this.info.n=this.info.questions.length-1,this.$dialog.toast({mes:"已经是最后一题！",timeout:1500}))},pre:function(){this.info.n--,this.n<0&&(this.info.n=0)},sendData:function(){var t=this;if(this.params.qus.data.is_answer)this.$dialog.toast({mes:"你已提交过该问卷！",timeout:1500});else{var e={app_id:this.params.qus.app_id,qrcode_product_id:this.params.qus.qrcode_product_id,questionnaire_answer:[],type:"question_and_a"},n=!1;this.info.questions.forEach(function(t){""!=t.user_answer&&t.user_answer!=[]||(n=!0),e.questionnaire_answer.push({questionnaire_answer_id:t.id,answer:t.user_answer})}),n?this.$dialog.confirm({title:"提示",mes:"你还有未填写的题目,是否提交！",opts:function(){t.saveData(e)}}):this.saveData(e)}},saveData:function(t){var e=this;(0,u.questionnaire)(t).then(function(t){e.$dialog.toast({mes:"提交成功",timeout:1500,icon:"success"}),e.info.is_answer=!0},function(t){e.$dialog.toast({mes:"提交失败",timeout:1500,icon:"error"})})}}}},164:function(t,e,n){},404:function(t,e,n){"use strict";var a=n(164);n.n(a).a},448:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("yd-layout",{staticClass:"body"},[n("yd-navbar",{attrs:{slot:"navbar",title:"问答",color:"#fff",bgcolor:"#3998e2"},slot:"navbar"},[n("a",{attrs:{slot:"left",href:"javascript:history.back(-1)"},slot:"left"},[n("yd-navbar-back-icon",{attrs:{color:"#fff"}},[t._v("返回")])],1)]),t.info.questions?n("div",{staticClass:"content"},[t._l(t.info.questions,function(e,a){return[n("div",{directives:[{name:"show",rawName:"v-show",value:a==t.info.n,expression:"i==info.n"}],staticClass:"group"},[n("div",{staticClass:"qus"},[n("span",{staticClass:"c4"},[t._v("问题 "+t._s(a+1))]),n("span",[t._v(t._s(e.question))])]),n("div",{staticClass:"ans"},[n("div",{staticClass:"txt"},[t.info.is_answer?n("span",[t._v("答："+t._s(e.answer))]):n("yd-textarea",{staticClass:"textarea",attrs:{slot:"right",placeholder:"请填写答案",maxlength:"500"},slot:"right",model:{value:e.user_answer,callback:function(n){t.$set(e,"user_answer",n)},expression:"item.user_answer"}})],1)])])]}),n("div",{staticClass:"handel"},[t.info.questions&&t.info.n>0?n("span",{staticClass:"pre",on:{click:t.pre}},[t._v("上一题 ")]):t._e(),t.info.questions&&t.info.n<t.info.questions.length-1?n("span",{staticClass:"next",on:{click:t.next}},[t._v("下一题")]):t._e()]),n("div",{staticClass:"btn"},[n("yd-button",{attrs:{size:"large",bgcolor:"#3998e2",color:"#fff"},nativeOn:{click:function(e){return t.sendData(e)}}},[t._v("提交调查")])],1)],2):t._e()],1)},o=[];n.d(e,"a",function(){return a}),n.d(e,"b",function(){return o})},62:function(t,e,n){"use strict";n.r(e);var a=n(448),o=n(162);for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);n(404);var r=n(9),s=Object(r.a)(o.default,a.a,a.b,!1,null,"e380914a",null);e.default=s.exports},87:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getList=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_get)("/system/app_manager/managers",t)},e.del=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/system/app_manager/managers/delete",t)},e.detail=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_get)(r(t),t)},e.save=function(t){var e=t.id,n=function(t,e){var n={};for(var a in t)e.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a]);return n}(t,["id"]);if(e)return(0,o.request_put)(r({id:e}),n);return(0,o.request_post)("/system/app_manager/managers",n).then(function(t){n.apps.forEach(function(e){s({manager_id:t.data.id,app_id:e.id})})})},e.getApps=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_get)("/system/app/apps",t)},e.authorize=s,e.revoke=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/system/app_manager/managers/app_revoke",t)},e.codeImage=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=Math.random().toFixed(3);return(0,o.request_get)("/common/api/captcha/image?code="+t)},e.codePhone=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/common/api/captcha/mobile",t)},e.userLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/common/api/auth/login/user",t).then(function(t){return window.sessionStorage.setItem("token",t.data.token),window.localStorage.setItem("token",t.data.token),config.token=t.data.token,t})},e.userReg=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/common/api/user/register",t)},e.backPwdCode=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/common/api/user/pass_reset/send",t)},e.setPwd=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/common/api/user/pass_reset/set",t)},e.phoneLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/common/api/auth/login_by_phone/user",t).then(function(t){return window.sessionStorage.setItem("token",t.data.token),window.localStorage.setItem("token",t.data.token),config.token=t.data.token,t})};var a,o=n(5),i=n(10);var r=((a=i)&&a.__esModule?a:{default:a}).default.compile("/system/api/app_manager/managers/:id");function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/system/app_manager/managers/app_authorize",t)}},88:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.code=e.main=void 0;var a=s(n(8)),o=s(n(89)),i=n(17),r=(n(11),n(87));function s(t){return t&&t.__esModule?t:{default:t}}var u=new o.default({phone:{required:!0,length:11,message:{required:"请输入手机号",length:"手机号码长度应为11位"}}}),c={data:function(){return{list:[],info:{},qrcode_id:this.$route.query.qrcode_id,page:{}}},created:function(){var t,e=this;return(t=a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$route.query.token_id&&window.sessionStorage.setItem("token",e.$route.query.token_id),window.sessionStorage.getItem("token")){t.next=5;break}return alert(123456),e.$router.push({path:"/login"}),t.abrupt("return");case 5:e.getList();case 6:case"end":return t.stop()}},t,e)}),function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function a(o,i){try{var r=e[o](i),s=r.value}catch(t){return void n(t)}if(!r.done)return Promise.resolve(s).then(function(t){a("next",t)},function(t){a("throw",t)});t(s)}("next")})})()},methods:{loadList:function(t){var e=this;t&&(0,i.setTimeout)(function(){e.list=[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(e.list),[{txt:"xxxxx"}]),e.$refs.infinitescroll.$emit("ydui.infinitescroll.finishLoad")},1e3)},go:function(t,e){this.$router.push({name:t,params:e})},to:function(t,e){this.$router.push({path:t,query:e})},outLink:function(t){location.href=t},pay:function(){},fetch:function(){return JSON.parse(window.localStorage.getItem("params")||"[]")},save:function(t){window.localStorage.setItem("params",JSON.stringify(t))}},computed:{unescapeHTML:function(){return function(t){return(t=""+t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")}}},watch:{params:{handler:function(t){this.save(t)},deep:!0}}},d={data:function(){return{img_code:{code_id:null,code_img:null},img_code_val:null,code_tip:"发送验证码",duration:60,timer:null}},methods:{getImgCode:function(){var t=this;(0,r.codeImage)().then(function(e){t.img_code=e.data})},validatePhone:function(){var t=u.validate({phone:this.info.phone});return!(t.length>0)||(this.$Toast({message:t[0].toString()}),!1)},setTimer:function(){var t=this;if(null===this.timer){var e=this.duration;!function n(){t.code_tip=e+"秒后再试",e-- >0?t.timer=(0,i.setTimeout)(n,1e3):(t.code_tip="发送验证码",t.timer=null)}()}},sendCheckCode:function(){var t=this;null!==this.img_code_val?this.validatePhone()&&!this.timer&&(0,r.codePhone)({phone:this.info.phone,code_id_img:this.img_code.code_id,code_val_img:this.img_code_val,not_check_user_exist:1}).then(function(e){t.$dialog.toast({mes:e.message||"发送成功",icon:"success",timeout:1500}),t.setTimer(),t.info.code_id=e.data.code_id}).catch(function(e){t.$dialog.toast({icon:"error",timeout:1500,mes:"发送失败"})}):this.$dialog.toast({mes:"请输入图片验证码",timeout:1e3})}}};e.main=c,e.code=d}}]);