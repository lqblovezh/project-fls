(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{153:function(t,e,n){"use strict";n.r(e);var o=n(154),i=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,function(){return o[t]})}(r);e.default=i.a},154:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(88),i=n(400),r=n(18);e.default={mixins:[o.main],data:function(){return{isShow:!1,className:"hidden",phone:"",formData:{id:"",qrcode_product_id:this.$route.query.qrcode_product_id,phone:"",award_id:""}}},mounted:function(){var t=this.$refs.scratch;new i.Scratch(t,{threshold:1})},methods:{getList:function(){var t=this,e=this.$route.query.id;this.$route.query.type?(0,r.get_app_info)({id:e,qrcode_product_id:this.$route.query.qrcode_product_id}).then(function(e){t.info=e.data,t.formData.id=e.data.id,t.formData.award_id=e.data.lottery_info.win_award_id}):(0,r.get_content)({id:e}).then(function(e){t.info=e.data,t.formData.id=e.data.id,t.formData.award_id=e.data.lottery_info.win_award_id})},sendMsg:function(){var t=this;this.isShow||this.info.is_answer||(this.isShow=!0,this.info,(0,r.lottery)(this.formData).then(function(e){t.info}))}},watch:{phone:function(){/^1[34578]\d{9}$/.test(this.phone)?this.isShow=!0:this.isShow=!1}}}},155:function(t,e,n){},400:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,n){this._config={lineWidth:40,threshold:.3,fillStyle:"#ccc"},this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._isFirstStart=!0,this.onScrachEnd=Function.prototype,this.onScrachStart=Function.prototype,t&&this.init(t,e,n)}return Object.defineProperty(t.prototype,"_isMobile",{get:function(){return/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._ctx},enumerable:!0,configurable:!0}),t.prototype._init=function(t,e,n){void 0===n&&(n=!0),Object.assign(this._config,e||{});var o=t.getBoundingClientRect();this._rect=o,t.style.position="relative",this._canvas.width=o.width,this._canvas.height=o.height;var i=getComputedStyle(t);return Object.assign(this._canvas.style,{position:"absolute",top:"-"+i.borderTopWidth,left:"-"+i.borderLeftWidth,cursor:"pointer"}),t.appendChild(this._canvas),n&&this.drawMask(),this},t.prototype.init=function(t,e,n){if(t instanceof HTMLElement)return this._init(t,e,n);if("string"==typeof t)return this._init(document.getElementById(t),e,n);if(!t||!t.el&&!t.id)throw new Error("element or id is need");return this._init(t.el||document.getElementById(t.id),t,e)},t.prototype.setConfig=function(t,e){var n;Object.assign(this._config,"string"==typeof t?((n={})[t]=e,n):t)},t.prototype.drawMask=function(t){void 0===t&&(t=this._config.fillStyle);var e=this._ctx;return this._isFirstStart=!0,e.fillStyle=t,e.globalCompositeOperation="source-over",e.fillRect(0,0,this._rect.width,this._rect.height),this._loadEvent(this._canvas,this._rect),this},t.prototype._loadEvent=function(t,e){var n=this;this._isMobile?(t.ontouchstart=function(t){return t.preventDefault(),n.touchStart([t.targetTouches[0].pageX-e.left,t.targetTouches[0].pageY-e.top]),!1},t.ontouchmove=function(t){return t.preventDefault(),n.touchMove([t.targetTouches[0].pageX-e.left,t.targetTouches[0].pageY-e.top]),!1},t.ontouchend=this.touchEnd.bind(this)):(t.onmousedown=function(t){return t.preventDefault(),n.touchStart([t.offsetX,t.offsetY]),!1},t.onmousemove=function(t){return t.preventDefault(),n.touchMove([t.offsetX,t.offsetY]),!1},t.onmouseout=t.onmouseup=function(t){return t.preventDefault(),n.touchEnd(),!1})},t.prototype._unLoadEvent=function(t){t.ontouchstart=t.ontouchmove=t.ontouchend=null,t.onmousedown=t.onmousemove=t.onmouseout=t.onmouseup=null},t.prototype.drawLine=function(t,e){var n=this._ctx;n.beginPath(),n.globalCompositeOperation="destination-out",n.moveTo.apply(n,t),n.lineCap="round",n.lineWidth=this._config.lineWidth,n.lineTo.apply(n,e),n.stroke(),n.closePath()},t.prototype.touchStart=function(t){this._isFirstStart&&(this.onScrachStart(),this._isFirstStart=!1),this._startPoint=t},t.prototype.touchMove=function(t){this._startPoint&&(this.drawLine(this._startPoint,t),this._startPoint=t)},t.prototype.touchEnd=function(){this._startPoint=null;var t=this._ctx.getImageData(0,0,this._rect.width,this._rect.height).data.filter(function(t,e){return e%4==3});t.filter(function(t){return!t}).length>t.length*this._config.threshold&&(this.clearMask(),this.onScrachEnd(),this._unLoadEvent(this._canvas))},t.prototype.clearMask=function(){this._ctx.clearRect(0,0,this._rect.width,this._rect.height)},t}();e.Scratch=o},401:function(t,e,n){"use strict";var o=n(155);n.n(o).a},445:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"body"},[n("yd-navbar",{attrs:{slot:"navbar",title:"幸运刮刮乐",color:"#fff",bgcolor:"#3998e2"},slot:"navbar"},[n("a",{attrs:{slot:"left",href:"javascript:history.back(-1)"},slot:"left"},[n("yd-navbar-back-icon",{attrs:{color:"#fff"}},[t._v("返回")])],1)]),n("div",{staticClass:"content"},[n("div",{staticClass:"lottery"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.info.is_answer,expression:"info.is_answer"}],staticClass:"scratch cover",on:{mouseover:t.sendMsg,touchstart:t.sendMsg}},[t.info.is_answer&&t.info.lottery_info?n("p",[t._v(t._s(t.info.lottery_info.win_award_name))]):t._e()]),n("div",{ref:"scratch",staticClass:"scratch",on:{touchstart:t.sendMsg}},[t.info.lottery_info?n("p",[t._v(t._s(t.info.lottery_info.win_award_name))]):t._e()])])])],1)},i=[];n.d(e,"a",function(){return o}),n.d(e,"b",function(){return i})},59:function(t,e,n){"use strict";n.r(e);var o=n(445),i=n(153);for(var r in i)"default"!==r&&function(t){n.d(e,t,function(){return i[t]})}(r);n(401);var a=n(9),s=Object(a.a)(i.default,o.a,o.b,!1,null,"5915f7d6",null);e.default=s.exports},87:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getList=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_get)("/system/app_manager/managers",t)},e.del=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_post)("/system/app_manager/managers/delete",t)},e.detail=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_get)(a(t),t)},e.save=function(t){var e=t.id,n=function(t,e){var n={};for(var o in t)e.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}(t,["id"]);if(e)return(0,i.request_put)(a({id:e}),n);return(0,i.request_post)("/system/app_manager/managers",n).then(function(t){n.apps.forEach(function(e){s({manager_id:t.data.id,app_id:e.id})})})},e.getApps=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_get)("/system/app/apps",t)},e.authorize=s,e.revoke=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_post)("/system/app_manager/managers/app_revoke",t)},e.codeImage=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=Math.random().toFixed(3);return(0,i.request_get)("/common/api/captcha/image?code="+t)},e.codePhone=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_post)("/common/api/captcha/mobile",t)},e.userLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_post)("/common/api/auth/login/user",t).then(function(t){return window.sessionStorage.setItem("token",t.data.token),window.localStorage.setItem("token",t.data.token),config.token=t.data.token,t})},e.userReg=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_post)("/common/api/user/register",t)},e.backPwdCode=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_post)("/common/api/user/pass_reset/send",t)},e.setPwd=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_post)("/common/api/user/pass_reset/set",t)},e.phoneLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_post)("/common/api/auth/login_by_phone/user",t).then(function(t){return window.sessionStorage.setItem("token",t.data.token),window.localStorage.setItem("token",t.data.token),config.token=t.data.token,t})};var o,i=n(5),r=n(10);var a=((o=r)&&o.__esModule?o:{default:o}).default.compile("/system/api/app_manager/managers/:id");function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.request_post)("/system/app_manager/managers/app_authorize",t)}},88:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.code=e.main=void 0;var o=s(n(8)),i=s(n(89)),r=n(17),a=(n(11),n(87));function s(t){return t&&t.__esModule?t:{default:t}}var u=new i.default({phone:{required:!0,length:11,message:{required:"请输入手机号",length:"手机号码长度应为11位"}}}),c={data:function(){return{list:[],info:{},qrcode_id:this.$route.query.qrcode_id,page:{}}},created:function(){var t,e=this;return(t=o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$route.query.token_id&&window.sessionStorage.setItem("token",e.$route.query.token_id),window.sessionStorage.getItem("token")){t.next=5;break}return alert(123456),e.$router.push({path:"/login"}),t.abrupt("return");case 5:e.getList();case 6:case"end":return t.stop()}},t,e)}),function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function o(i,r){try{var a=e[i](r),s=a.value}catch(t){return void n(t)}if(!a.done)return Promise.resolve(s).then(function(t){o("next",t)},function(t){o("throw",t)});t(s)}("next")})})()},methods:{loadList:function(t){var e=this;t&&(0,r.setTimeout)(function(){e.list=[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(e.list),[{txt:"xxxxx"}]),e.$refs.infinitescroll.$emit("ydui.infinitescroll.finishLoad")},1e3)},go:function(t,e){this.$router.push({name:t,params:e})},to:function(t,e){this.$router.push({path:t,query:e})},outLink:function(t){location.href=t},pay:function(){},fetch:function(){return JSON.parse(window.localStorage.getItem("params")||"[]")},save:function(t){window.localStorage.setItem("params",JSON.stringify(t))}},computed:{unescapeHTML:function(){return function(t){return(t=""+t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")}}},watch:{params:{handler:function(t){this.save(t)},deep:!0}}},d={data:function(){return{img_code:{code_id:null,code_img:null},img_code_val:null,code_tip:"发送验证码",duration:60,timer:null}},methods:{getImgCode:function(){var t=this;(0,a.codeImage)().then(function(e){t.img_code=e.data})},validatePhone:function(){var t=u.validate({phone:this.info.phone});return!(t.length>0)||(this.$Toast({message:t[0].toString()}),!1)},setTimer:function(){var t=this;if(null===this.timer){var e=this.duration;!function n(){t.code_tip=e+"秒后再试",e-- >0?t.timer=(0,r.setTimeout)(n,1e3):(t.code_tip="发送验证码",t.timer=null)}()}},sendCheckCode:function(){var t=this;null!==this.img_code_val?this.validatePhone()&&!this.timer&&(0,a.codePhone)({phone:this.info.phone,code_id_img:this.img_code.code_id,code_val_img:this.img_code_val,not_check_user_exist:1}).then(function(e){t.$dialog.toast({mes:e.message||"发送成功",icon:"success",timeout:1500}),t.setTimer(),t.info.code_id=e.data.code_id}).catch(function(e){t.$dialog.toast({icon:"error",timeout:1500,mes:"发送失败"})}):this.$dialog.toast({mes:"请输入图片验证码",timeout:1e3})}}};e.main=c,e.code=d}}]);