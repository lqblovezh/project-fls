(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1095:function(t,e,n){"use strict";var a=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"div"},[e("SwitchSys",{attrs:{currentPlant:this.currentPlant}})],1)},s=[];n.d(e,"a",function(){return a}),n.d(e,"b",function(){return s})},1103:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"div"},[n("div",{staticClass:"alltop",class:{showMoreTop:t.showMoreTop},on:{mouseleave:function(e){t.showMoreTop=!1}}},[n("ul",{staticClass:"otherTop"},[n("li",{class:{active:t.isBase},on:{click:function(e){t.goPage("/common/admin")}}},[t._m(0)]),t._l(t.outlink,function(e){return n("li",{class:{active:e.is_current},on:{click:function(n){t.goPage(e)}}},[n("div",{staticClass:"content"},[n("p",{staticClass:"title"},[t._v(t._s(e.title))]),n("p",{staticClass:"name"},[t._v(t._s(e.name))])])])})],2),n("header",{staticClass:"header"},[n("div",{staticClass:"left",domProps:{textContent:t._s(t.left)},on:{click:t.showMore}}),t.plantInfo&&!t.isXDataVisible?n("div",{staticClass:"content"},[t._v("（"+t._s(t.plantInfo.name)+"）")]):t._e(),t.userInfo?n("div",{staticClass:"right"},[n("span",{staticClass:"user"},[t._v(t._s(t.userName))]),n("span",{staticClass:"logoutBtn",on:{click:t.logout}},[t._v("退出登录")]),n("span",{staticClass:"logoutBtn",on:{click:t.changePass}},[t._v("修改密码")]),n("el-dialog",{attrs:{visible:t.loginDialog,width:"420px","close-on-click-modal":!1,"lock-scroll":!1,"before-close":t.handleClose,"append-to-body":!0},on:{"update:visible":function(e){t.loginDialog=e}}},[n("div",{staticClass:"top",attrs:{slot:"title"},slot:"title"},[n("el-tabs",{attrs:{value:"pass"}},[n("el-tab-pane",{attrs:{label:"修改密码",name:"pass"}})],1)],1),n("form",{ref:"passForm",staticClass:"passContent"},[n("div",{staticClass:"group"},[n("div",{staticClass:"label"},[t._v("旧密码:")]),n("input",{staticClass:"form-control",attrs:{name:"old_pass",type:"password"},domProps:{value:t.passData.old_pass}})]),n("div",{staticClass:"group"},[n("div",{staticClass:"label"},[t._v("新密码:")]),n("input",{staticClass:"form-control",attrs:{name:"new_pass",type:"password"},domProps:{value:t.passData.new_pass}})]),n("div",{staticClass:"group"},[n("div",{staticClass:"label"},[t._v("新密码确认:")]),n("input",{staticClass:"form-control",attrs:{name:"new_pass_confirm",type:"password"},domProps:{value:t.passData.new_pass_confirm}})])]),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.loginDialog=!1}}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:t.changePassword}},[t._v("确 定")])],1)])],1):t._e()])])])},s=[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("p",{staticClass:"title"}),e("p",{staticClass:"name"},[this._v("西南交大System")])])}];n.d(e,"a",function(){return a}),n.d(e,"b",function(){return s})},295:function(t,e){var n=/^(?:submit|button|image|reset|file)$/i,a=/^(?:input|select|textarea|keygen)/i,s=/(\[[^\[\]]*\])/g;function o(t,e,n){if(e.match(s)){!function t(e,n,a){if(0===n.length)return e=a;var s=n.shift(),o=s.match(/^\[(.+?)\]$/);if("[]"===s)return e=e||[],Array.isArray(e)?e.push(t(null,n,a)):(e._values=e._values||[],e._values.push(t(null,n,a))),e;if(o){var r=o[1],i=+r;isNaN(i)?(e=e||{})[r]=t(e[r],n,a):(e=e||[])[i]=t(e[i],n,a)}else e[s]=t(e[s],n,a);return e}(t,function(t){var e=[],n=new RegExp(s),a=/^([^\[\]]*)/.exec(t);for(a[1]&&e.push(a[1]);null!==(a=n.exec(t));)e.push(a[1]);return e}(e),n)}else{var a=t[e];a?(Array.isArray(a)||(t[e]=[a]),t[e].push(n)):t[e]=n}return t}function r(t,e,n){return n=n.replace(/(\r)?\n/g,"\r\n"),n=(n=encodeURIComponent(n)).replace(/%20/g,"+"),t+(t?"&":"")+encodeURIComponent(e)+"="+n}t.exports=function(t,e){"object"!=typeof e?e={hash:!!e}:void 0===e.hash&&(e.hash=!0);for(var s=e.hash?{}:"",i=e.serializer||(e.hash?o:r),u=t&&t.elements?t.elements:[],l=Object.create(null),c=0;c<u.length;++c){var f=u[c];if((e.disabled||!f.disabled)&&f.name&&a.test(f.nodeName)&&!n.test(f.type)){var d=f.name,p=f.value;if("checkbox"!==f.type&&"radio"!==f.type||f.checked||(p=void 0),e.empty){if("checkbox"!==f.type||f.checked||(p=""),"radio"===f.type&&(l[f.name]||f.checked?f.checked&&(l[f.name]=!0):l[f.name]=!1),void 0==p&&"radio"==f.type)continue}else if(!p)continue;if("select-multiple"!==f.type)s=i(s,d,p);else{p=[];for(var v=f.options,h=!1,g=0;g<v.length;++g){var m=v[g],_=e.empty&&!m.value,w=m.value||_;m.selected&&w&&(h=!0,s=e.hash&&"[]"!==d.slice(d.length-2)?i(s,d+"[]",m.value):i(s,d,m.value))}!h&&e.empty&&(s=i(s,d,""))}}}if(e.empty)for(var d in l)l[d]||(s=i(s,d,""));return s}},410:function(t,e,n){"use strict";n.r(e);var a=n(411),s=n.n(a);for(var o in a)"default"!==o&&function(t){n.d(e,t,function(){return a[t]})}(o);e.default=s.a},411:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});s(n(295));var a=s(n(674));function s(t){return t&&t.__esModule?t:{default:t}}e.default={props:["leftName","title","currentPlant"],components:{SwitchSys:a.default}}},412:function(t,e,n){"use strict";n.r(e);var a=n(413),s=n.n(a);for(var o in a)"default"!==o&&function(t){n.d(e,t,function(){return a[t]})}(o);e.default=s.a},413:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=p(n(15)),s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},o=p(n(295)),r=n(414),i=n(675),u=n(49),l=p(n(50)),c=p(n(113)),f=n(82),d=n(112);function p(t){return t&&t.__esModule?t:{default:t}}var v="read",h="system"==v&&!0&&"desktop"=="desktop";e.default={props:["leftName","title","currentPlant"],data:function(){return{userInfo:null,current:"",plantInfo:null,loginDialog:!1,showMoreTop:!1,outlink:"",isBase:!0,passData:{old_pass:null,new_pass:null,new_pass_confirm:null}}},mounted:function(){var t=this;"system"!=v&&(0,f.platInfo)().then(function(e){t.outlink=e.data.publisher.apps,t.outlink.forEach(function(e){e.is_current&&(t.isBase=!1)})}),this.current=this.currentPlant,sessionStorage.userInfo&&(this.userInfo=l.default.parse(sessionStorage.userInfo)),this.$config.userInfo&&(this.userInfo=this.$config.userInfo),this.$config.userInfo||sessionStorage.userInfo||this.checklogin()},computed:{left:function(){return this.leftName||"显示平台"},isXDataVisible:function(){return this.$store.state.xDataVisible},isXDataTextVisible:function(){return!0},userName:function(){return this.userInfo?this.userInfo.user.name:null}},methods:s({checklogin:function(){var t,e=(t=a.default.mark(function t(){var e=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,d.isLogin)().then(function(t){e.userInfo=t.data});case 2:case"end":return t.stop()}},t,this)}),function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function a(s,o){try{var r=e[s](o),i=r.value}catch(t){return void n(t)}if(!r.done)return Promise.resolve(i).then(function(t){a("next",t)},function(t){a("throw",t)});t(i)}("next")})});return function(){return e.apply(this,arguments)}}(),handleClose:function(t){this.passData.old_pass=null,this.passDatanew_pass=null,this.passDatanew_pass_confirm=null,this.loginDialog=!1},changeCode:function(t){var e=t.currentTarget;e.src=e.src},logout:function(){this.$confirm("是否确认退出?").then(function(t){(h?i.loginOut:r.loginOut)().then(function(t){sessionStorage.userInfo=!1,window.location.href=h?"/system/admin":"/admin"})}).catch(function(t){})},changePass:function(){this.loginDialog=!0},changePassword:function(){var t=this,e=(0,o.default)(this.$refs.passForm,{hash:!0});(0,r.changePass)(e).then(function(e){t.$message.success("修改密码成功！"),t.loginDialog=!1,window.location.href="../"}).catch(function(e){var n=e.payload;for(var a in n.messages){t.$message.error(n.messages[a]);break}})},goPage:function(t){"string"!=typeof t?t.name!=this.currentPlant?location.href=(0,c.default)(t.base_url,"admin"):this.$message.error("你正处在该平台"):location.href=t},showMore:function(){this.showMoreTop=!this.showMoreTop}},(0,u.mapMutations)(["updateUser","openXData","closeXData"]))}},414:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.register=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.request_post)("/common/api/user/register",t)},e.login=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.request_post)("/common/api/auth/login/user",t).then(function(t){return window.sessionStorage.setItem("token",t.data.token),window.localStorage.setItem("token",t.data.token),o.default.token=t.data.token,t})},e.thirdLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.request_post)("/common/api/auth/third/link",t)},e.phoneLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.request_post)("/common/api/auth/login_by_phone/phone",t).then(function(t){return window.sessionStorage.setItem("token",t.data.token),window.localStorage.setItem("token",t.data.token),o.default.token=t.data.token,t})},e.codeImage=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=Math.random().toFixed(3);return(0,a.request_get)("/common/api/captcha/image?code="+t)},e.codeCheck=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.request_post)("/common/api/captcha/check",t)},e.codePhone=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.request_post)("/common/api/captcha/mobile",t)},e.codeEmail=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.request_post)("/common/api/captcha/email",t)},e.getUserInfo=function(){return(0,a.request_get)("/api/auth/is_login/user")},e.save=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.request_put)("/common/api/user",t)},e.loginOut=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.request_post)("/common/api/auth/logout",t).then(function(t){return window.sessionStorage.removeItem("token"),window.sessionStorage.removeItem("userInfo"),o.default.token=null,t})},e.changePass=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.request_put)("/common/api/auth/pass",t)},e.saveMemberData=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.request_put)(i(t),t)};var a=n(48),s=r(n(81)),o=(r(n(50)),r(n(51)));function r(t){return t&&t.__esModule?t:{default:t}}var i=s.default.compile("/common/api/user/:id")},415:function(t,e,n){},416:function(t,e,n){},589:function(t,e,n){"use strict";n.r(e);var a=n(1095),s=n(410);for(var o in s)"default"!==o&&function(t){n.d(e,t,function(){return s[t]})}(o);n(677);var r=n(0),i=Object(r.a)(s.default,a.a,a.b,!1,null,"2f9deda0",null);i.options.__file="Top.vue",e.default=i.exports},674:function(t,e,n){"use strict";n.r(e);var a=n(1103),s=n(412);for(var o in s)"default"!==o&&function(t){n.d(e,t,function(){return s[t]})}(o);n(676);var r=n(0),i=Object(r.a)(s.default,a.a,a.b,!1,null,"30e441f6",null);i.options.__file="SwitchSys.vue",e.default=i.exports},675:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t};e.listRole=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_get)("/system/api/manager/roles",t)},e.listManager=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_get)("/system/api/manager/managers",t)},e.addManager=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/system/api/manager/managers",t)},e.modifyManager=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,n=u(t,["id"]);return(0,o.request_put)(l({id:e}),n)},e.detailManager=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,n=u(t,["id"]);return(0,o.request_get)(l({id:e}),n)},e.detailRole=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,n=u(t,["id"]);return e?(0,o.request_get)(c({id:e}),n).then(function(t){var e={};if(t.status){e=t.data.accesses;var n={allow_create:0,allow_view_all:0,allow_edit_all:0,allow_delete_all:0};return f().then(function(s){if(s.status){var o=s.data,r={};for(var i in o)r[o[i].id]=a({},o[i],n),e[o[i].id]&&(r[o[i].id]=a({},o[i],e[o[i].id]));return s.data=r,log(t,222),s}})}}):d()},e.allJurisdiction=f,e._allJurisdiction=d,e.role=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,n=u(t,["id"]);if(log(n),e)return(0,o.request_put)(c({id:e}),n);return(0,o.request_post)("/system/api/manager/roles",n)},e.addRole=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/system/api/manager/roles",t)},e.deleteManager=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/system/api/manager/managers/delete",t)},e.deleteRole=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/system/api/manager/roles/delete",t)},e.logManager=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_get)("/system/api/manager/logs",t)},e.login=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/system/api/auth/login/manager",t)},e.isLogin=function(){return(0,o.request_get)("/system/api/auth/is_login/manager")},e.loginOut=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.request_post)("/system/api/auth/logout",t)};var s,o=n(48),r=n(81),i=(s=r)&&s.__esModule?s:{default:s};function u(t,e){var n={};for(var a in t)e.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a]);return n}var l=i.default.compile("/system/api/manager/managers/:id"),c=i.default.compile("/system/api/manager/roles/:id");function f(){return(0,o.request_get)("/system/api/manager/accesses")}function d(){return(0,o.request_get)("/system/api/manager/accesses").then(function(t){if(t.status){var e={allow_create:0,allow_view_all:0,allow_edit_all:0,allow_delete_all:0},n=t.data,s={};for(var o in n)s[n[o].id]=a({},n[o],e);return t.data=s,t}})}},676:function(t,e,n){"use strict";var a=n(415);n.n(a).a},677:function(t,e,n){"use strict";var a=n(416);n.n(a).a}}]);